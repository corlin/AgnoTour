from textwrap import dedent
from typing import List

from agno.agent import Agent, RunResponse  # noqa
from agno.models.openai import OpenAIChat
from pydantic import BaseModel, Field


class MovieScript(BaseModel):
    setting: str = Field(
        ...,
        description="ç”µå½±ä¸»è¦åœ°ç‚¹å’Œæ—¶é—´æ®µçš„ä¸°å¯Œè¯¦ç»†ã€å……æ»¡æ°›å›´çš„æè¿°ã€‚åŒ…æ‹¬æ„Ÿå®˜ç»†èŠ‚å’Œæƒ…ç»ªã€‚",
    )
    ending: str = Field(
        ...,
        description="ç”µå½±æœ‰åŠ›çš„ç»“å±€ï¼Œè¿æ¥æ‰€æœ‰æƒ…èŠ‚çº¿ç´¢ã€‚åº”å¸¦æ¥æƒ…æ„Ÿå†²å‡»å’Œæ»¡è¶³æ„Ÿã€‚",
    )
    genre: str = Field(
        ...,
        description="ç”µå½±çš„ä¸»è¦å’Œæ¬¡è¦ç±»å‹ï¼ˆä¾‹å¦‚ï¼Œ'ç§‘å¹»æƒŠæ‚šç‰‡'ï¼Œ'æµªæ¼«å–œå‰§'ï¼‰ã€‚åº”ä¸åœºæ™¯å’ŒåŸºè°ƒä¸€è‡´ã€‚",
    )
    name: str = Field(
        ...,
        description="ä¸€ä¸ªå¼•äººæ³¨ç›®ã€ä»¤äººéš¾å¿˜çš„æ ‡é¢˜ï¼Œæ•æ‰æ•…äº‹çš„ç²¾é«“å¹¶å¸å¼•ç›®æ ‡è§‚ä¼—ã€‚",
    )
    characters: List[str] = Field(
        ...,
        description="4-6ä¸ªä¸»è¦è§’è‰²ï¼Œå¸¦æœ‰ç‹¬ç‰¹çš„åå­—å’Œç®€çŸ­çš„è§’è‰²æè¿°ï¼ˆä¾‹å¦‚ï¼Œ'é™ˆæ´å¨œ' - æ‹¥æœ‰é»‘æš—ç§˜å¯†çš„æ°å‡ºé‡å­ç‰©ç†å­¦å®¶'ï¼‰ã€‚",
    )
    storyline: str = Field(
        ...,
        description="ä¸€ä¸ªå¼•äººå…¥èƒœçš„ä¸‰å¥è¯æƒ…èŠ‚æ‘˜è¦ï¼šè®¾ç½®ã€å†²çªå’ŒèµŒæ³¨ã€‚ç”¨ é˜´è°‹ å’Œ æƒ…æ„Ÿ å¸å¼•è¯»è€…ã€‚",
    )



# Agent that uses JSON mode
json_mode_agent = Agent(
    model=OpenAIChat(
        id="openai/gpt-4o",
        #"deepseek/deepseek-chat-v3-0324",
        #"openai/gpt-4o",
        #x-ai/grok-3-beta",
        #grok-3
        #grok-3-mini
        #x-ai/grok-3-mini-beta
        base_url="https://openrouter.ai/api/v1"
        #"https://api.x.ai/v1"
    ),
    description=dedent("""\
æ‚¨æ˜¯ä¸€ä½å¤‡å—èµèª‰çš„å¥½è±åç¼–å‰§ï¼Œä»¥åˆ›ä½œä»¤äººéš¾å¿˜çš„å¤§ç‰‡è€Œé—»åï¼ğŸ¬
æ‹¥æœ‰å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°ã€äºšä¼¦Â·ç´¢é‡‘å’Œæ˜†æ±€Â·å¡”ä¼¦è’‚è¯ºçš„ç»¼åˆå™äº‹æ‰èƒ½ï¼Œ
æ‚¨æ‰“é€ å‡ºç‹¬ç‰¹çš„æ•…äº‹æƒ…èŠ‚ï¼Œå¸å¼•äº†å…¨ä¸–ç•Œçš„è§‚ä¼—ã€‚

æ‚¨çš„ä¸“é•¿æ˜¯å°†åœ°ç‚¹è½¬åŒ–ä¸ºé²œæ´»çš„ã€ä¼šå‘¼å¸çš„è§’è‰²ï¼Œæ¨åŠ¨å™äº‹å‘å±•ã€‚
\
    """),
    instructions=dedent("""\
åœ¨åˆ›ä½œç”µå½±æ¦‚å¿µæ—¶ï¼Œè¯·éµå¾ªä»¥ä¸‹åŸåˆ™ï¼š

1. åœºæ™¯åº”æˆä¸ºè§’è‰²ï¼š
   - ç”¨æ„Ÿå®˜ç»†èŠ‚è®©åœ°ç‚¹å˜å¾—ç”ŸåŠ¨
   - åŒ…å«å½±å“æ•…äº‹çš„æ°›å›´å…ƒç´ 
   - è€ƒè™‘æ—¶é—´æ®µå¯¹å™äº‹çš„å½±å“

2. è§’è‰²å‘å±•ï¼š
   - èµ‹äºˆæ¯ä¸ªè§’è‰²ç‹¬ç‰¹çš„å£°éŸ³å’Œæ˜ç¡®çš„åŠ¨æœº
   - åˆ›é€ å¼•äººå…¥èƒœçš„å…³ç³»å’Œå†²çª
   - ç¡®ä¿å¤šæ ·åŒ–çš„ä»£è¡¨æ€§å’ŒçœŸå®çš„èƒŒæ™¯

3. æ•…äº‹ç»“æ„ï¼š
   - ä»¥ä¸€ä¸ªå¸å¼•æ³¨æ„åŠ›çš„é’©å­å¼€å§‹
   - é€šè¿‡ä¸æ–­å‡çº§çš„å†²çªå»ºç«‹ç´§å¼ æ„Ÿ
   - æä¾›ä»¤äººæƒŠè®¶å´åˆå¿…ç„¶çš„ç»“å±€

4. ç±»å‹æŒæ¡ï¼š
   - æ‹¥æŠ±ç±»å‹æƒ¯ä¾‹ï¼ŒåŒæ—¶åŠ å…¥æ–°é²œçš„è½¬æŠ˜
   - æ·±æ€ç†Ÿè™‘åœ°æ··åˆç±»å‹ä»¥è·å¾—ç‹¬ç‰¹çš„ç»„åˆ
   - ä¿æŒä¸€è‡´çš„åŸºè°ƒè´¯ç©¿å§‹ç»ˆ

å°†æ¯ä¸ªåœ°ç‚¹è½¬åŒ–ä¸ºä»¤äººéš¾å¿˜çš„ç”µå½±ä½“éªŒï¼\
    """),
    response_model=MovieScript,
)

# Agent that uses structured outputs
structured_output_agent = Agent(
    model=OpenAIChat(
        id="openai/gpt-4o",
        #"deepseek/deepseek-chat-v3-0324",
        #"openai/gpt-4o",
        #x-ai/grok-3-beta",
        #grok-3
        #grok-3-mini
        #x-ai/grok-3-mini-beta
        base_url="https://openrouter.ai/api/v1"
        #"https://api.x.ai/v1"
    ),
    description=dedent("""\
æ‚¨æ˜¯ä¸€ä½å¤‡å—èµèª‰çš„å¥½è±åç¼–å‰§ï¼Œä»¥åˆ›ä½œä»¤äººéš¾å¿˜çš„å¤§ç‰‡è€Œé—»åï¼ğŸ¬
æ‹¥æœ‰å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°ã€äºšä¼¦Â·ç´¢é‡‘å’Œæ˜†æ±€Â·å¡”ä¼¦è’‚è¯ºçš„ç»¼åˆå™äº‹æ‰èƒ½ï¼Œ
æ‚¨æ‰“é€ å‡ºç‹¬ç‰¹çš„æ•…äº‹æƒ…èŠ‚ï¼Œå¸å¼•äº†å…¨ä¸–ç•Œçš„è§‚ä¼—ã€‚

æ‚¨çš„ä¸“é•¿æ˜¯å°†åœ°ç‚¹è½¬åŒ–ä¸ºé²œæ´»çš„ã€ä¼šå‘¼å¸çš„è§’è‰²ï¼Œæ¨åŠ¨å™äº‹å‘å±•ã€‚\
    """),
    instructions=dedent("""\
åœ¨åˆ›ä½œç”µå½±æ¦‚å¿µæ—¶ï¼Œè¯·éµå¾ªä»¥ä¸‹åŸåˆ™ï¼š

1. åœºæ™¯åº”æˆä¸ºè§’è‰²ï¼š
   - ç”¨æ„Ÿå®˜ç»†èŠ‚è®©åœ°ç‚¹å˜å¾—ç”ŸåŠ¨
   - åŒ…å«å½±å“æ•…äº‹çš„æ°›å›´å…ƒç´ 
   - è€ƒè™‘æ—¶é—´æ®µå¯¹å™äº‹çš„å½±å“

2. è§’è‰²å‘å±•ï¼š
   - èµ‹äºˆæ¯ä¸ªè§’è‰²ç‹¬ç‰¹çš„å£°éŸ³å’Œæ˜ç¡®çš„åŠ¨æœº
   - åˆ›é€ å¼•äººå…¥èƒœçš„å…³ç³»å’Œå†²çª
   - ç¡®ä¿å¤šæ ·åŒ–çš„ä»£è¡¨æ€§å’ŒçœŸå®çš„èƒŒæ™¯

3. æ•…äº‹ç»“æ„ï¼š
   - ä»¥ä¸€ä¸ªå¸å¼•æ³¨æ„åŠ›çš„é’©å­å¼€å§‹
   - é€šè¿‡ä¸æ–­å‡çº§çš„å†²çªå»ºç«‹ç´§å¼ æ„Ÿ
   - æä¾›ä»¤äººæƒŠè®¶å´åˆå¿…ç„¶çš„ç»“å±€

4. ç±»å‹æŒæ¡ï¼š
   - æ‹¥æŠ±ç±»å‹æƒ¯ä¾‹ï¼ŒåŒæ—¶åŠ å…¥æ–°é²œçš„è½¬æŠ˜
   - æ·±æ€ç†Ÿè™‘åœ°æ··åˆç±»å‹ä»¥è·å¾—ç‹¬ç‰¹çš„ç»„åˆ
   - ä¿æŒä¸€è‡´çš„åŸºè°ƒè´¯ç©¿å§‹ç»ˆ

å°†æ¯ä¸ªåœ°ç‚¹è½¬åŒ–ä¸ºä»¤äººéš¾å¿˜çš„ç”µå½±ä½“éªŒï¼\
    """),
    response_model=MovieScript,
)

# Example usage with different locations
json_mode_agent.print_response("ä¸œäº¬", stream=True)
structured_output_agent.print_response("å¤ç½—é©¬", stream=True)

# More examples to try:
"""
æ¢ç´¢çš„åˆ›æ„åœ°ç‚¹æç¤ºï¼š
1. â€œæ°´ä¸‹ç ”ç©¶ç«™â€ - é€‚ç”¨äº å¹½é—­ææƒ§ç—‡ å¼çš„ ç§‘å¹»æƒŠæ‚šç‰‡
2. â€œç»´å¤šåˆ©äºšæ—¶ä»£ä¼¦æ•¦â€ - é€‚ç”¨äºå“¥ç‰¹å¼ç¥ç§˜æ•…äº‹
3. â€œè¿ªæ‹œ2050â€ - é€‚ç”¨äºæœªæ¥ä¸»ä¹‰æŠ¢åŠ«ç”µå½±
4. â€œå—æç ”ç©¶åŸºåœ°â€ - é€‚ç”¨äºç”Ÿå­˜ææ€–æ•…äº‹
5. â€œåŠ å‹’æ¯”å²›å±¿â€ - é€‚ç”¨äºçƒ­å¸¦å†’é™©æµªæ¼«æ•…äº‹

"""

# To get the response in a variable:
from rich.pretty import pprint

json_mode_response: RunResponse = json_mode_agent.run("â€œç»´å¤šåˆ©äºšæ—¶ä»£ä¼¦æ•¦â€")
pprint(json_mode_response.content)
structured_output_response: RunResponse = structured_output_agent.run("è¿ªæ‹œ2050")
pprint(structured_output_response.content)